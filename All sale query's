--1
-- THIS IS FOR THE LOV FOR SELECTING THE SALE OFFICER
SELECT 
    AU.USER_NAME AS D , 
    AU.USER_ID USER_ID 
FROM 
    AB_UM_APPLICATION_USERS AU
 JOIN AB_UM_APP_USER_ORG ORG ON ORG.USER_ID = AU.USER_ID
 WHERE
      C
 AND ORG.ORG_ID=:GV_ORG_ID
ORDER BY
    AU.AU_ID ASC

--2
--THIS IS FOR THE SALE OFFCER SALE ORDER MEANS IN THIS THERE IS ITEM AND BAGS 
select 
       ITM.ITEM_ID,
       ITM.ITEM_NAME,
       SIDD.QTY,
       SIDD.RATE,
       SIDD.AMOUNT,
       SIDD.NET,
       SIDD.CREATED_BY
    FROM  AB_ITEMS_MASTER  ITM
    LEFT JOIN  AB_SALE_INFO_DET SIDD ON SIDD.ITEM_ID=ITM.ITEM_ID
      
WHERE SIDD.SALE_ID = :P135_SALE_DETAIL

--3
-- THIS IS THE QUREY FOR THE SALE OFFICERS TOTAL BAGS 
select SUM(NVL(QTY,0)) as SALE_BAGS,
    50000 AS TARGET_VALUE from
(
select 
       ITM.ITEM_ID,
       ITM.ITEM_NAME,
       SIDD.QTY AS QTY,
       SIDD.RATE,
       SIDD.AMOUNT,
       SIDD.NET,
       SIDD.CREATED_BY
    FROM  AB_ITEMS_MASTER  ITM
    LEFT JOIN  AB_SALE_INFO_DET SIDD ON SIDD.ITEM_ID=ITM.ITEM_ID
) 

--4
--THIS IS FOR GETTTING THE TOTAL CUSTOMERS AND THE COUNT OF THE CALLS MADE TO THSES CUSTOMERS
  SELECT 
    (SELECT COUNT(REG_NAME) 
     FROM AB_SETUP_REGISTRATION 
     WHERE REG_TYPE = 'CUSTOMER REGISTRATION' 
     AND ORG_ID = :GV_ORG_ID) AS TOTAL_CUSTOMER,
     
    (SELECT COUNT(*) 
     FROM AB_SALE_INFO_DET 
     WHERE TO_CHAR(UPDATED_ON, 'DD-MON-YYYY') = TO_CHAR(SYSDATE, 'DD-MON-YYYY')
     AND ORG_ID = :GV_ORG_ID) AS TOTAL_CALL_TODAY
     
FROM dual;

--5
--SHOWING THE SALE OFFICERS AND THE CUSTOMER NAMES AND THEIR SALE OFFICERS NAMES 

WITH CUSTOMER_REG AS (
            SELECT
                SR_ID CUSTOMER_ID,
                 REG_NAME CUSTOMER_NAME
            FROM
                AB_SETUP_REGISTRATION  SR
            WHERE
                REG_TYPE='CUSTOMER REGISTRATION'
)
    SELECT
            SI.SALE_ID,
            CUSTOMER_NAME,
            USER_NAME SALE_OFFICER,
            SI.DUE_DATE,
            CASE WHEN LD.LOOKUP_DET_NAME='P' THEN 'P'  ELSE 'X'  END FREIGHT_TYPE,
            SI.AREA,
            SI.CREATED_ON,
            SI.CREATED_BY
  FROM
                           AB_SALE_INFO SI 
        LEFT JOIN AB_UM_APPLICATION_USERS UAU ON UAU.USER_ID=SI.EMP_ID
        LEFT  JOIN  CUSTOMER_REG CR ON CR.CUSTOMER_ID=SI.CUSTOMER_ID
        LEFT JOIN AB_LOOKUP_DETAIL LD ON LD.DET_ID = SI.FREIGHT_TYPE_ID
                  AND LD.LOOKUP_ID = 022
                  AND SI.ORG_ID = :GV_ORG_ID
        WHERE
                       SALE_TYPE='SALE ORDER' 
   ORDER BY
         SALE_ID DESC
   
--6
--THIS QUREY SHOWS THE SALE ORDERS 
WITH CUSTOMER_REG AS (
            SELECT
                SR_ID CUSTOMER_ID,
                 REG_NAME CUSTOMER_NAME
            FROM
                AB_SETUP_REGISTRATION  SR
            WHERE
                REG_TYPE='CUSTOMER REGISTRATION'
)
    SELECT
            SI.SALE_ID,
            CUSTOMER_NAME,
            USER_NAME AS SALE_OFFICER,
            SI.EMP_ID,
            UAU.USER_ID
           
  FROM
                           AB_SALE_INFO SI 
        LEFT JOIN AB_UM_APPLICATION_USERS UAU ON UAU.USER_ID=SI.EMP_ID
        LEFT  JOIN  CUSTOMER_REG CR ON CR.CUSTOMER_ID=SI.CUSTOMER_ID
        LEFT JOIN AB_LOOKUP_DETAIL LD ON LD.DET_ID = SI.FREIGHT_TYPE_ID
                  AND LD.LOOKUP_ID = 022
                  AND SI.ORG_ID = :GV_ORG_ID
        WHERE
                       SALE_TYPE='SALE ORDER'
   ORDER BY
         SALE_ID DESC

--7
--UPDATED THE 6 QUREY IN THIS SHOWING THE SALE ORDER REPROT , IN THIS THERE IS THE COUNT OF THE CUSTOMER THAT IS BELONGS TO THE SALE OFFICER
WITH CUSTOMER_REG AS (
    SELECT
        SR_ID AS CUSTOMER_ID,
        REG_NAME AS CUSTOMER_NAME
    FROM
        AB_SETUP_REGISTRATION SR
    WHERE
        REG_TYPE = 'CUSTOMER REGISTRATION'
)
SELECT
    UAU.USER_NAME AS SALE_OFFICER,
    COUNT(DISTINCT SI.CUSTOMER_ID) AS CUSTOMER_COUNT
FROM
    AB_SALE_INFO SI
    LEFT JOIN AB_UM_APPLICATION_USERS UAU ON UAU.USER_ID = SI.EMP_ID
    LEFT JOIN CUSTOMER_REG CR ON CR.CUSTOMER_ID = SI.CUSTOMER_ID
    LEFT JOIN AB_LOOKUP_DETAIL LD ON LD.DET_ID = SI.FREIGHT_TYPE_ID
        AND LD.LOOKUP_ID = 022
        AND SI.ORG_ID = :GV_ORG_ID
WHERE
    SALE_TYPE = 'SALE ORDER'
GROUP BY
    UAU.USER_NAME
ORDER BY
    CUSTOMER_COUNT DESC;

--8
-- IN THIS THERE IS THE LSIT OF ALL CUSTOMERS
WITH CUSTOMER_ASSIGN AS (
                        SELECT
                              SIDD.CUSTOMER_ID
                        FROM
                                    AB_SALE_INFO SI
                          JOIN  AB_SALE_INFO_DET  SIDD  ON SIDD.SALE_ID=SI.SALE_ID
                        WHERE
                                DET_SALE_TYPE='CUSTOMER ASSIGN DET'
                        AND SIDD.STATUS='Y'        
)
            SELECT 
                      ASR.SR_ID AS CUSTOMER_ID,
                      ASR.REG_NAME CUSTOMER_NAME, 
                      CASE WHEN ASR.REG_STATUS = 'Y' THEN 'Active' ELSE 'Disable' END AS STATUS
                    
                    FROM 
                                 AB_SETUP_REGISTRATION ASR
             LEFT JOIN  CUSTOMER_ASSIGN CA ON CA.CUSTOMER_ID=ASR.SR_ID
             WHERE 
                        ASR.REG_TYPE = 'CUSTOMER REGISTRATION'
             AND   ORG_ID = :GV_ORG_ID
             AND   CA.CUSTOMER_ID IS  NULL     
              ORDER BY
                   ASR.SR_ID DESC;

--9
-- THIS IS SHOWING THE SALE OFFICERS CUSTOMERS
select 
       ASID.SALE_ID,
       ASID.DET_SALE_TYPE,
       ASID.SD_IDS,
       ASID.ITEM_ID,
       ASID.QTY,
       ASID.STATUS,
       ASID.ORG_ID,
       ASID.CUSTOMER_ID,
       ASR.REG_NAME CUSTOMER_NAME
           from AB_SALE_INFO_DET ASID
   join AB_SALE_INFO SI on SI.sale_id = ASID.SALE_ID
   JOIN AB_UM_APPLICATION_USERS UAU ON UAU.USER_ID=SI.EMP_ID
  LEFT JOIN  ab_setup_registration  ASR ON ASID.CUSTOMER_ID=ASR.SR_ID
  WHERE 
         ASID.DET_SALE_TYPE = 'CUSTOMER ASSIGN DET'
   AND  UAU.USER_ID=nvl(:P153_SALE_OFFICER,null)
    AND SI.ORG_ID=:GV_ORG_ID
    AND ASID.STATUS='Y'
    order by ASR.SR_ID desc

--10
-- IN THIS THERE IS COUNT OF THE CUSTOMER , BUT THIS QUREY DOSENOT LINKED WIHT THE SALE ORDER
SELECT 
    UAU.USER_NAME AS SALE_OFFICER,
    COUNT(DISTINCT ASID.CUSTOMER_ID) AS CUSTOMER_COUNT
FROM 
    AB_SALE_INFO_DET ASID
JOIN 
    AB_SALE_INFO SI ON SI.SALE_ID = ASID.SALE_ID
JOIN 
    AB_UM_APPLICATION_USERS UAU ON UAU.USER_ID = SI.EMP_ID
LEFT JOIN  
    AB_SETUP_REGISTRATION ASR ON ASID.CUSTOMER_ID = ASR.SR_ID
WHERE 
    ASID.DET_SALE_TYPE = 'CUSTOMER ASSIGN DET'
    AND UAU.USER_ID = NVL(:P153_SALE_OFFICER, NULL)
    AND SI.ORG_ID = :GV_ORG_ID
    AND ASID.STATUS = 'Y'
GROUP BY 
    UAU.USER_NAME
ORDER BY 
    CUSTOMER_COUNT DESC;


--11 
-- IN THIS PRODUCT WSIE AND THE SAEL OFFICER WISE ENTRY AND THE SUM OF THE QTY WHERE THE SALE OFFICER AND THE ITEM_ID IS SAME
SELECT
    UAU.USER_NAME AS SALE_OFFICER,
    SIDD.ITEM_ID,
    ITM.ITEM_NAME,
    SUM(NVL(SIDD.QTY, 0)) AS TOTAL_QTY,
    AVG(SIDD.RATE) AS AVG_RATE,  -- Optionally use AVG if you want a single rate value for the item
    SUM(SIDD.AMOUNT) AS TOTAL_AMOUNT
FROM
    AB_SALE_INFO SI
    LEFT JOIN AB_UM_APPLICATION_USERS UAU ON UAU.USER_ID = SI.EMP_ID
    LEFT JOIN AB_UM_APP_USER_ORG ORG ON ORG.USER_ID = UAU.USER_ID
    LEFT JOIN AB_LOOKUP_DETAIL LD ON LD.DET_ID = SI.FREIGHT_TYPE_ID
    LEFT JOIN AB_SALE_INFO_DET SIDD ON SIDD.SALE_ID = SI.SALE_ID  
    JOIN AB_ITEMS_MASTER ITM ON ITM.ITEM_ID = SIDD.ITEM_ID
WHERE
    SALE_TYPE = 'SALE ORDER'
    AND ORG.STATUS = 'Y'
    AND LD.LOOKUP_ID = 022
    AND ORG.ORG_ID = :GV_ORG_ID
GROUP BY
    SIDD.ITEM_ID,
    ITM.ITEM_NAME,
    UAU.USER_NAME
    
--12
-- IN THIS THERE IS SAME OF THE QTY AGAISNT THE ITEM_ID WITHOUT REFERIING THE SALE OFFICER

   SELECT
    SIDD.ITEM_ID,
    ITM.ITEM_NAME,
    SUM(NVL(SIDD.QTY, 0)) AS TOTAL_QTY
 FROM
    AB_SALE_INFO SI
    LEFT JOIN AB_UM_APPLICATION_USERS UAU ON UAU.USER_ID = SI.EMP_ID
    LEFT JOIN AB_UM_APP_USER_ORG ORG ON ORG.USER_ID = UAU.USER_ID
    LEFT JOIN AB_LOOKUP_DETAIL LD ON LD.DET_ID = SI.FREIGHT_TYPE_ID
    LEFT JOIN AB_SALE_INFO_DET SIDD ON SIDD.SALE_ID = SI.SALE_ID  
    JOIN AB_ITEMS_MASTER ITM ON ITM.ITEM_ID = SIDD.ITEM_ID
WHERE
    SALE_TYPE = 'SALE ORDER'
    AND ORG.STATUS = 'Y'
    AND LD.LOOKUP_ID = 022
    AND ORG.ORG_ID = :GV_ORG_ID
GROUP BY
    SIDD.ITEM_ID,
    ITM.ITEM_NAME

--13
-- IN THIS THERE IS THE THE ADDTION OF THE BRAND NAME MEANS THAT THE MAIN CATEGORY 
    SELECT
    SIDD.ITEM_ID,
    ITM.ITEM_NAME,
   -- SUM(NVL(SIDD.QTY, 0)) AS TOTAL_QTY,
   -- MAX(CASE WHEN LDD.DET_ID = ITM.ITEM_TYPE_ID THEN LDD.LOOKUP_DET_NAME END) AS ITEM_TYPE,
    MAX(CASE WHEN LDD.DET_ID = ITM.BRAND_NAME_ID THEN LDD.LOOKUP_DET_NAME END) AS BRAND_NAME
FROM
    AB_SALE_INFO SI
    LEFT JOIN AB_UM_APPLICATION_USERS UAU ON UAU.USER_ID = SI.EMP_ID
    LEFT JOIN AB_UM_APP_USER_ORG ORG ON ORG.USER_ID = UAU.USER_ID
    LEFT JOIN AB_LOOKUP_DETAIL LD ON LD.DET_ID = SI.FREIGHT_TYPE_ID
    LEFT JOIN AB_SALE_INFO_DET SIDD ON SIDD.SALE_ID = SI.SALE_ID  
    JOIN AB_ITEMS_MASTER ITM ON ITM.ITEM_ID = SIDD.ITEM_ID
    LEFT JOIN AB_LOOKUP_DETAIL LDD ON LDD.DET_ID IN (ITM.PRODUCT_CATEGORY_ID, ITM.ITEM_TYPE_ID, ITM.BRAND_NAME_ID)
WHERE
    SALE_TYPE = 'SALE ORDER'
    AND ORG.STATUS = 'Y'
    AND LD.LOOKUP_ID = 022
    AND ORG.ORG_ID = :GV_ORG_ID
GROUP BY
    SIDD.ITEM_ID,
    ITM.ITEM_NAME
